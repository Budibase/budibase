# Architecture

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [lerna.json](https://github.com/Budibase/budibase/blob/e981536b/lerna.json)
- [packages/backend-core/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/backend-core/package.json)
- [packages/backend-core/src/context/index.ts](https://github.com/Budibase/budibase/blob/e981536b/packages/backend-core/src/context/index.ts)
- [packages/backend-core/src/db/couch/index.ts](https://github.com/Budibase/budibase/blob/e981536b/packages/backend-core/src/db/couch/index.ts)
- [packages/backend-core/src/db/index.ts](https://github.com/Budibase/budibase/blob/e981536b/packages/backend-core/src/db/index.ts)
- [packages/backend-core/src/index.ts](https://github.com/Budibase/budibase/blob/e981536b/packages/backend-core/src/index.ts)
- [packages/bbui/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/bbui/package.json)
- [packages/bbui/src/Form/Core/index.js](https://github.com/Budibase/budibase/blob/e981536b/packages/bbui/src/Form/Core/index.js)
- [packages/builder/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/builder/package.json)
- [packages/cli/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/cli/package.json)
- [packages/client/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/client/package.json)
- [packages/client/tsconfig.json](https://github.com/Budibase/budibase/blob/e981536b/packages/client/tsconfig.json)
- [packages/frontend-core/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/frontend-core/package.json)
- [packages/server/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/server/package.json)
- [packages/string-templates/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/string-templates/package.json)
- [packages/types/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/types/package.json)
- [packages/worker/package.json](https://github.com/Budibase/budibase/blob/e981536b/packages/worker/package.json)

</details>



This document describes the high-level architecture of Budibase, explaining its component structure, service organization, and data flow. It focuses on how the various services and components interact to form the complete Budibase platform. For specific details about the package structure, see [Package Structure](#1.2).

## Overview

Budibase is a low-code platform built with a microservices-like architecture. The system is organized as a monorepo containing several interconnected packages that make up the full platform. At its core, Budibase uses a server-worker architecture pattern for backend operations and a builder-client model for frontend functionality.

```mermaid
flowchart TD
    User["User"] --> |"interacts with"| Builder["Builder UI"]
    User --> |"uses"| PublishedApp["Published Application"]
    
    subgraph "Frontend Components"
        Builder -- "builds/configures" --> PublishedApp
        Builder <--> BuilderStore["Builder Store"]
    end
    
    subgraph "Backend Services"
        Server["Server API"] <--> Worker["Worker Service"]
        Server --> Database[(Database)]
        Server --> ObjectStore[(Object Store)]
        Worker --> |"processes"| AutomationQueue[("Automation Queue")]
    end
    
    Builder --> |"API requests"| Server
    PublishedApp --> |"API requests"| Server
    
    subgraph "Data Sources"
        InternalDB["Internal Database"]
        ExternalDB["External Databases"]
        API["External APIs"]
    end
    
    Server --> DataSources
    DataSources --> InternalDB
    DataSources --> ExternalDB
    DataSources --> API
```

Sources: 
- `packages/server/package.json`
- `packages/worker/package.json`
- `packages/builder/package.json`
- `packages/client/package.json`

## Core Services

Budibase consists of two main backend services that handle all server-side operations.

### Server Service

The Server service is the primary API interface that handles client requests, data operations, and resource management. It serves as the central hub for all Budibase operations.

Key responsibilities:
- API endpoints for data operations
- Authentication and authorization
- Database connections and data management
- User management
- App deployment and publishing
- Serving web assets

```mermaid
flowchart TD
    subgraph "Server Service"
        APIRoutes["API Routes"] --> Controllers["Controllers"]
        Controllers --> SDK["SDK Layer"]
        SDK --> DatabaseConnections["Database Connections"]
        SDK --> ExternalIntegrations["External Integrations"]
        Controllers --> EventEmitter["Event Emitter"]
        EventEmitter --> |"triggers"| Automations["Automation Engine"]
    end
    
    Client["Client Applications"] --> |"HTTP requests"| APIRoutes
    DatabaseConnections --> |"connects to"| InternalDB[(Internal Database)]
    ExternalIntegrations --> |"connects to"| ExternalSources[(External Data Sources)]
    Automations --> |"queues jobs"| WorkerQueue[(Worker Queue)]
```

Sources:
- `packages/server/package.json`
- `packages/backend-core/src/index.ts`
- `packages/backend-core/src/db/index.ts`

### Worker Service

The Worker service handles background tasks, scheduled jobs, and automation processing. It operates independently from the Server service but shares common backend code.

Key responsibilities:
- Processing automation jobs
- Handling scheduled tasks
- Email sending
- Background data processing
- Long-running operations

```mermaid
flowchart TD
    subgraph "Worker Service"
        QueueConsumer["Queue Consumer"] --> JobProcessor["Job Processor"]
        JobProcessor --> AutomationOrchestrator["Automation Orchestrator"]
        JobProcessor --> ScheduledTasks["Scheduled Tasks"]
        JobProcessor --> EmailService["Email Service"]
    end
    
    Server["Server Service"] --> |"enqueues jobs"| Queue[(Job Queue)]
    Queue --> QueueConsumer
    AutomationOrchestrator --> |"executes"| AutomationSteps["Automation Steps"]
    EmailService --> |"sends"| EmailProvider["Email Provider"]
```

Sources:
- `packages/worker/package.json`
- `packages/backend-core/src/index.ts`

## Data Management

Budibase uses a sophisticated data management system that can work with both internal and external data sources.

### Database Architecture

The platform utilizes CouchDB/PouchDB as its primary internal database system, with the ability to connect to various external databases through integrations.

```mermaid
flowchart TD
    subgraph "Data Access Layer"
        RowController["Row Controller"] --> RowSDK["Row SDK"]
        RowSDK --> |"internal"| InternalHandler["Internal Database Handler"]
        RowSDK --> |"external"| ExternalHandler["External Database Handler"]
        
        ViewsController["Views Controller"] --> ViewsSDK["Views SDK"]
        ViewsSDK --> RowSDK
    end
    
    InternalHandler --> CouchDB[(CouchDB/PouchDB)]
    ExternalHandler --> |"SQL"| SQLDatabases[(SQL Databases)]
    ExternalHandler --> |"NoSQL"| NoSQLDatabases[(NoSQL Databases)]
    ExternalHandler --> |"API"| RestAPIs[(REST APIs)]
    
    Client["Client Application"] --> RowController
    Client --> ViewsController
```

Sources:
- `packages/backend-core/src/db/index.ts`
- `packages/backend-core/src/db/couch/index.ts`

### Object Storage

For larger binary files and assets, Budibase uses an object storage system that can connect to S3-compatible storage providers.

```mermaid
flowchart TD
    subgraph "Object Storage"
        ObjectStoreSDK["Object Store SDK"] --> S3Provider["S3 Provider"]
        ObjectStoreSDK --> LocalProvider["Local Provider"]
    end
    
    Client["Client Application"] --> |"upload/download"| Server["Server API"]
    Server --> ObjectStoreSDK
    S3Provider --> |"stores in"| S3[(S3/MinIO)]
    LocalProvider --> |"stores in"| FileSystem[(File System)]
```

Sources:
- `packages/backend-core/src/index.ts` (references objectStore)

## Frontend Architecture

The frontend of Budibase consists of two main components: the Builder and the Client.

### Builder

The Builder is the application creation interface that developers use to design, configure, and deploy applications.

```mermaid
flowchart TD
    subgraph "Builder"
        BuilderUI["Builder UI"] --> BuilderStore["Builder Store"]
        BuilderUI --> ComponentLibrary["Component Library"]
        BuilderUI --> DataConfiguration["Data Configuration"]
        BuilderUI --> ScreenDesigner["Screen Designer"]
        BuilderUI --> AutomationBuilder["Automation Builder"]
        
        BuilderStore --> |"manages state"| AppDefinition["App Definition"]
    end
    
    ComponentLibrary --> |"uses"| BBUIComponents["BBUI Components"]
    
    BuilderUI --> |"API requests"| Server["Server API"]
    BuilderUI --> |"previews"| ClientPreview["Client Preview"]
```

Sources:
- `packages/builder/package.json`
- `packages/bbui/package.json`
- `packages/bbui/src/Form/Core/index.js`

### Client

The Client is the runtime environment for published Budibase applications, responsible for rendering the application UI and handling user interactions.

```mermaid
flowchart TD
    subgraph "Client"
        ClientRuntime["Client Runtime"] --> ComponentRenderer["Component Renderer"]
        ClientRuntime --> DataProvider["Data Provider"]
        ClientRuntime --> EventHandler["Event Handler"]
        
        DataProvider --> |"fetches"| AppData["Application Data"]
        ComponentRenderer --> |"uses"| BBUIComponents["BBUI Components"]
    end
    
    ClientRuntime --> |"API requests"| Server["Server API"]
    User["End User"] --> |"interacts with"| ClientRuntime
```

Sources:
- `packages/client/package.json`
- `packages/client/tsconfig.json`

## Automation System

The automation system allows users to create workflows that can be triggered by events, schedules, or manually.

```mermaid
flowchart TD
    subgraph "Automation System"
        TriggerDefinition["Trigger Definition"] --> |"creates"| AutomationJob["Automation Job"]
        AutomationJob --> |"enqueued in"| JobQueue["Job Queue"]
        JobQueue --> |"processed by"| Worker["Worker Service"]
        Worker --> |"executes"| Orchestrator["Orchestrator"]
        Orchestrator --> |"runs"| Steps["Automation Steps"]
    end
    
    subgraph "Trigger Types"
        Event["Event Trigger"]
        Schedule["Schedule Trigger"]
        Manual["Manual Trigger"]
    end
    
    Event --> TriggerDefinition
    Schedule --> TriggerDefinition
    Manual --> TriggerDefinition
    
    subgraph "Step Types"
        Action["Action Step"]
        Condition["Condition Step"]
        Loop["Loop Step"]
    end
    
    Steps --> Action
    Steps --> Condition
    Steps --> Loop
```

Sources:
- `packages/worker/package.json`
- `packages/backend-core/src/index.ts` (references queue)

## Component System

The component system is the foundation of the user interface in Budibase applications. It provides a library of pre-built components that can be configured and composed to create application screens.

```mermaid
flowchart TD
    subgraph "Component System"
        ComponentDefinition["Component Definition"] --> ComponentSettings["Component Settings"]
        ComponentDefinition --> ComponentStyles["Component Styles"]
        ComponentDefinition --> DataBindings["Data Bindings"]
        ComponentDefinition --> EventHandlers["Event Handlers"]
    end
    
    subgraph "Component Types"
        Containers["Container Components"]
        FormInputs["Form Input Components"]
        DataDisplay["Data Display Components"]
        Navigation["Navigation Components"]
    end
    
    ComponentLibrary["Component Library"] --> ComponentDefinition
    ComponentLibrary --> Containers
    ComponentLibrary --> FormInputs
    ComponentLibrary --> DataDisplay
    ComponentLibrary --> Navigation
    
    Builder["Builder"] --> |"configures"| ComponentLibrary
    Client["Client"] --> |"renders"| ComponentDefinition
```

Sources:
- `packages/bbui/package.json`
- `packages/bbui/src/Form/Core/index.js`

## Data Binding and Templates

Budibase uses a data binding system that connects UI components to data sources and a templating system for dynamic content.

```mermaid
flowchart TD
    subgraph "Data Binding System"
        BindingDefinition["Binding Definition"] --> DataContext["Data Context"]
        DataContext --> RowData["Row Data"]
        DataContext --> StateData["State Data"]
        DataContext --> UserData["User Data"]
    end
    
    subgraph "Templating System"
        StringTemplate["String Template"] --> HandlebarsEngine["Handlebars Engine"]
        HandlebarsEngine --> HelperFunctions["Helper Functions"]
    end
    
    Component["UI Component"] --> |"uses"| BindingDefinition
    Component --> |"uses"| StringTemplate
    StringTemplate --> |"resolves using"| DataContext
```

Sources:
- `packages/string-templates/package.json`
- `packages/frontend-core/package.json`

## Authentication and Authorization

Budibase includes a comprehensive security system for user authentication and authorization.

```mermaid
flowchart TD
    subgraph "Authentication"
        AuthController["Auth Controller"] --> AuthProviders["Auth Providers"]
        AuthProviders --> Local["Local Authentication"]
        AuthProviders --> OAuth["OAuth Providers"]
        AuthProviders --> OIDC["OpenID Connect"]
    end
    
    subgraph "Authorization"
        RoleSystem["Role System"] --> Permissions["Permission Checks"]
        Permissions --> ResourceAccess["Resource Access Control"]
    end
    
    User["User"] --> |"authenticates via"| AuthController
    AuthController --> |"establishes"| Session["User Session"]
    Session --> |"associates with"| RoleSystem
    Client["Client Application"] --> |"requests"| Server["Server API"]
    Server --> |"checks"| Permissions
```

Sources:
- `packages/backend-core/src/index.ts` (references auth, roles, permissions)
- `packages/worker/package.json` (passport dependencies)

## Multi-tenancy and Environments

Budibase supports multi-tenancy for hosting multiple organizations and applications on a single installation.

```mermaid
flowchart TD
    subgraph "Multi-tenancy"
        TenantManager["Tenant Manager"] --> TenantContext["Tenant Context"]
        TenantContext --> AppContext["App Context"]
    end
    
    subgraph "Database Isolation"
        TenantDB["Tenant Database"] --> AppDB["App Database"]
    end
    
    Request["Incoming Request"] --> TenantResolver["Tenant Resolver"]
    TenantResolver --> |"establishes"| TenantContext
    TenantContext --> |"connects to"| TenantDB
    AppContext --> |"connects to"| AppDB
```

Sources:
- `packages/backend-core/src/context/index.ts`
- `packages/server/package.json` (multi-tenancy scripts)
- `packages/worker/package.json` (multi-tenancy scripts)

## Deployment Options

Budibase supports different deployment options, including self-hosting and cloud deployment.

```mermaid
flowchart TD
    subgraph "Deployment Options"
        SelfHosted["Self-Hosted"] --> Docker["Docker Deployment"]
        SelfHosted --> Kubernetes["Kubernetes Deployment"]
        Cloud["Cloud Deployment"] --> BudibaseCloud["Budibase Cloud"]
    end
    
    subgraph "System Components"
        Server["Server Service"]
        Worker["Worker Service"]
        Database["Database"]
        ObjectStore["Object Storage"]
        Redis["Redis"]
    end
    
    Docker --> |"contains"| Server
    Docker --> |"contains"| Worker
    Docker --> |"contains"| Database
    Docker --> |"contains"| ObjectStore
    Docker --> |"contains"| Redis
    
    CLI["Budibase CLI"] --> |"manages"| Docker
```

Sources:
- `packages/cli/package.json`
- `packages/server/package.json` (docker scripts)
- `packages/worker/package.json` (docker scripts)

## Summary

Budibase's architecture combines multiple specialized services that work together to provide a complete low-code application platform. The separation between server and worker services allows for efficient handling of both synchronous and asynchronous operations, while the builder and client components provide intuitive interfaces for application development and usage.