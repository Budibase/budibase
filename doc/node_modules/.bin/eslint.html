<!DOCTYPE html>
<html>
<head>
  <title>eslint</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/eslint";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#helpers">Helpers</a>
      </div>

      <div class="heading h2">
        <a href="#execution">Execution</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>eslint</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/* eslint no-console:off */</span>

<span class="hljs-meta">"use strict"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>to use V8's code cache to speed up instantiation time</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">"v8-compile-cache"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>must do this initialization <em>before</em> other requires in order to work</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (process.argv.includes(<span class="hljs-string">"--debug"</span>)) {
    <span class="hljs-built_in">require</span>(<span class="hljs-string">"debug"</span>).enable(<span class="hljs-string">"eslint:*,-eslint:code-path,eslintrc:*"</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="helpers">
  <h2>
    <a href="#helpers" name="helpers" class="pilcrow"></a>
Helpers
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Read data from stdin til the end.</p>
</div>
<div class="body">
<p>Note: See</p>
<ul>
<li>https://github.com/nodejs/node/blob/master/doc/api/process.md#processstdin</li>
<li>https://github.com/nodejs/node/blob/master/doc/api/process.md#a-note-on-process-io</li>
<li>https://lists.gnu.org/archive/html/bug-gnu-emacs/2016-01/msg00419.html</li>
<li>https://github.com/nodejs/node/issues/7439 (historical)</li>
</ul>
<p>On Windows using <code>fs.readFileSync(STDIN_FILE_DESCRIPTOR, &quot;utf8&quot;)</code> seems
to read 4096 bytes before blocking and never drains to read further data.</p>
<p>The investigation on the Emacs thread indicates:</p>
<blockquote>
<p>Emacs on MS-Windows uses pipes to communicate with subprocesses; a
pipe on Windows has a 4K buffer. So as soon as Emacs writes more than
4096 bytes to the pipe, the pipe becomes full, and Emacs then waits for
the subprocess to read its end of the pipe, at which time Emacs will
write the rest of the stuff.</p>
</blockquote>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readStdin</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> content = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">let</span> chunk = <span class="hljs-string">""</span>;

        process.stdin
            .setEncoding(<span class="hljs-string">"utf8"</span>)
            .on(<span class="hljs-string">"readable"</span>, () =&gt; {
                <span class="hljs-keyword">while</span> ((chunk = process.stdin.read()) !== <span class="hljs-literal">null</span>) {
                    content += chunk;
                }
            })
            .on(<span class="hljs-string">"end"</span>, () =&gt; resolve(content))
            .on(<span class="hljs-string">"error"</span>, reject);
    });
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the error message of a given value.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">error</span>
<span class="dox_type">any</span>
<span>The value to get.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getErrorMessage</span>(<span class="hljs-params">error</span>) </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Lazy loading because this is used only if an error happened.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Foolproof -- thirdparty module might throw non-object.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> error !== <span class="hljs-string">"object"</span> || error === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(error);
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Use templates if <code>error.messageTemplate</code> is present.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> error.messageTemplate === <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> template = <span class="hljs-built_in">require</span>(<span class="hljs-string">`../messages/<span class="hljs-subst">${error.messageTemplate}</span>.js`</span>);

            <span class="hljs-keyword">return</span> template(error.messageData || {});
        } <span class="hljs-keyword">catch</span> {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Ignore template error then fallback to use <code>error.stack</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Use the stacktrace if it's an error object.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> error.stack === <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">return</span> error.stack;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Otherwise, dump the object.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> util.format(<span class="hljs-string">"%o"</span>, error);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Catch and report unexpected error.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">error</span>
<span class="dox_type">any</span>
<span>The thrown error object.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFatalError</span>(<span class="hljs-params">error</span>) </span>{
    process.exitCode = <span class="hljs-number">2</span>;

    <span class="hljs-keyword">const</span> { version } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../package.json"</span>);
    <span class="hljs-keyword">const</span> message = getErrorMessage(error);

    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`
Oops! Something went wrong! :(

ESLint: <span class="hljs-subst">${version}</span>

<span class="hljs-subst">${message}</span>`</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="execution">
  <h2>
    <a href="#execution" name="execution" class="pilcrow"></a>
Execution
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>{
    process.on(<span class="hljs-string">"uncaughtException"</span>, onFatalError);
    process.on(<span class="hljs-string">"unhandledRejection"</span>, onFatalError);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Call the config initializer if <code>--init</code> is present.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (process.argv.includes(<span class="hljs-string">"--init"</span>)) {
        <span class="hljs-keyword">await</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/init/config-initializer"</span>).initializeConfig();
        <span class="hljs-keyword">return</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Otherwise, call the CLI.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    process.exitCode = <span class="hljs-keyword">await</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/cli"</span>).execute(
        process.argv,
        process.argv.includes(<span class="hljs-string">"--stdin"</span>) ? <span class="hljs-keyword">await</span> readStdin() : <span class="hljs-literal">null</span>
    );
}()).catch(onFatalError);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
