<!DOCTYPE html>
<html>
<head>
  <title>conventional-commits-parser</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/conventional-commits-parser";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>conventional-commits-parser</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-meta">'use strict'</span>
<span class="hljs-keyword">const</span> conventionalCommitsParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./'</span>)
<span class="hljs-keyword">const</span> forEach = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>).forEach
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> isTextPath = <span class="hljs-built_in">require</span>(<span class="hljs-string">'is-text-path'</span>)
<span class="hljs-keyword">const</span> JSONStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'JSONStream'</span>)
<span class="hljs-keyword">const</span> meow = <span class="hljs-built_in">require</span>(<span class="hljs-string">'meow'</span>)
<span class="hljs-keyword">const</span> readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline'</span>)
<span class="hljs-keyword">const</span> split = <span class="hljs-built_in">require</span>(<span class="hljs-string">'split2'</span>)
<span class="hljs-keyword">const</span> through = <span class="hljs-built_in">require</span>(<span class="hljs-string">'through2'</span>)

<span class="hljs-keyword">const</span> filePaths = []
<span class="hljs-keyword">let</span> separator = <span class="hljs-string">'\n\n\n'</span>

<span class="hljs-keyword">const</span> cli = meow(<span class="hljs-string">`
    Practice writing commit messages or parse messages from files.
    If used without specifying a text file path, you will enter an interactive shell.
    Otherwise the commit messages in the files are parsed and printed
    By default, commits will be split by three newlines ('\\n\\n\\n') or you can specify a separator.

    Usage
      conventional-commits-parser [&lt;commit-separator&gt;]
      conventional-commits-parser [&lt;commit-separator&gt;] &lt;path&gt; [&lt;path&gt; ...]
      cat &lt;path&gt; | conventional-commits-parser [&lt;commit-separator&gt;]

    Example
      conventional-commits-parser
      conventional-commits-parser log.txt
      cat log.txt | conventional-commits-parser
      conventional-commits-parser log2.txt '===' &gt;&gt; parsed.txt

    Options
      -p, --header-pattern              Regex to match header pattern
      -c, --header-correspondence       Comma separated parts used to define what capturing group of 'headerPattern' captures what
      -r, --reference-actions           Comma separated keywords that used to reference issues
      -i, --issue-prefixes              Comma separated prefixes of an issue
      --issue-prefixes-case-sensitive   Treat issue prefixes as case sensitive
      -n, --note-keywords               Comma separated keywords for important notes
      -f, --field-pattern               Regex to match other fields
      --revert-pattern                  Regex to match revert pattern
      --revert-correspondence           Comma separated fields used to define what the commit reverts
      -v, --verbose                     Verbose output
`</span>, {
  <span class="hljs-attr">flags</span>: {
    <span class="hljs-string">'header-pattern'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'p'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'header-correspondence'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'c'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'reference-actions'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'r'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'issue-prefixes'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'i'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'issue-prefixes-case-sensitive'</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>
    },
    <span class="hljs-string">'note-keywords'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'n'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'field-pattern'</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'f'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'revert-pattern'</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-string">'revert-correspondence'</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    },
    <span class="hljs-attr">verbose</span>: {
      <span class="hljs-attr">alias</span>: <span class="hljs-string">'v'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>
    }
  }
})

forEach(cli.input, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
  <span class="hljs-keyword">if</span> (isTextPath(arg)) {
    filePaths.push(arg)
  } <span class="hljs-keyword">else</span> {
    separator = arg
  }
})

<span class="hljs-keyword">const</span> length = filePaths.length
<span class="hljs-keyword">const</span> options = cli.flags

<span class="hljs-keyword">if</span> (options.verbose) {
  options.warn = <span class="hljs-built_in">console</span>.log.bind(<span class="hljs-built_in">console</span>)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processFile</span> (<span class="hljs-params">fileIndex</span>) </span>{
  <span class="hljs-keyword">const</span> filePath = filePaths[fileIndex]
  fs.createReadStream(filePath)
    .on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'Failed to read file '</span> + filePath + <span class="hljs-string">'\n'</span> + err)
      <span class="hljs-keyword">if</span> (++fileIndex &lt; length) {
        processFile(fileIndex)
      }
    })
    .pipe(split(separator))
    .pipe(conventionalCommitsParser(options))
    .pipe(JSONStream.stringify())
    .on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (++fileIndex &lt; length) {
        processFile(fileIndex)
      }
    })
    .pipe(process.stdout)
}

<span class="hljs-keyword">if</span> (process.stdin.isTTY) {
  <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">0</span>) {
    processFile(<span class="hljs-number">0</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">let</span> commit = <span class="hljs-string">''</span>
    <span class="hljs-keyword">const</span> stream = through()
    <span class="hljs-keyword">const</span> rl = readline.createInterface({
      <span class="hljs-attr">input</span>: process.stdin,
      <span class="hljs-attr">output</span>: process.stdout,
      <span class="hljs-attr">terminal</span>: <span class="hljs-literal">true</span>
    })

    stream.pipe(conventionalCommitsParser(options))
      .pipe(JSONStream.stringify(<span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>))
      .pipe(through(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk, enc, cb</span>) </span>{
        <span class="hljs-keyword">if</span> (chunk.toString() === <span class="hljs-string">'""'</span>) {
          cb(<span class="hljs-literal">null</span>, <span class="hljs-string">'Commit cannot be parsed\n'</span>)
        } <span class="hljs-keyword">else</span> {
          cb(<span class="hljs-literal">null</span>, chunk + <span class="hljs-string">'\n'</span>)
        }
      }))
      .pipe(process.stdout)

    rl.on(<span class="hljs-string">'line'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line</span>) </span>{
      commit += line + <span class="hljs-string">'\n'</span>
      <span class="hljs-keyword">if</span> (commit.indexOf(separator) === <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">return</span>
      }

      stream.write(commit)
      commit = <span class="hljs-string">''</span>
    })
  }
} <span class="hljs-keyword">else</span> {
  options.warn = <span class="hljs-literal">true</span>
  process.stdin
    .pipe(split(separator))
    .pipe(conventionalCommitsParser(options))
    .on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.error(err.toString())
      process.exit(<span class="hljs-number">1</span>)
    })
    .pipe(JSONStream.stringify())
    .pipe(process.stdout)
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
