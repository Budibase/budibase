{"version":3,"file":"envelope.js","sourceRoot":"","sources":["../../src/envelope.ts"],"names":[],"mappings":"","sourcesContent":["import { ClientReport } from './clientreport';\nimport { Event } from './event';\nimport { SdkInfo } from './sdkinfo';\nimport { Session, SessionAggregates } from './session';\nimport { TransactionSamplingMethod } from './transaction';\nimport { UserFeedback } from './user';\n\n// Based on: https://develop.sentry.dev/sdk/envelopes/\n\nexport type BaseEnvelopeHeaders = {\n  [key: string]: unknown;\n  dsn?: string;\n  sdk?: SdkInfo;\n};\n\nexport type BaseEnvelopeItemHeaders = {\n  [key: string]: unknown;\n  type: string;\n  length?: number;\n};\n\ntype BaseEnvelopeItem<IH extends BaseEnvelopeItemHeaders, P extends unknown> = [IH, P]; // P is for payload\n\ntype BaseEnvelope<EH extends BaseEnvelopeHeaders, I extends BaseEnvelopeItem<BaseEnvelopeItemHeaders, unknown>> = [\n  EH,\n  I[],\n];\n\ntype EventItemHeaders = {\n  type: 'event' | 'transaction';\n  sample_rates?: [{ id?: TransactionSamplingMethod; rate?: number }];\n};\ntype AttachmentItemHeaders = { type: 'attachment'; filename: string };\ntype UserFeedbackItemHeaders = { type: 'user_report' };\ntype SessionItemHeaders = { type: 'session' };\ntype SessionAggregatesItemHeaders = { type: 'sessions' };\ntype ClientReportItemHeaders = { type: 'client_report' };\n\n// TODO(v7): Remove the string union from `Event | string`\n// We have to allow this hack for now as we pre-serialize events because we support\n// both store and envelope endpoints.\nexport type EventItem = BaseEnvelopeItem<EventItemHeaders, Event | string>;\nexport type AttachmentItem = BaseEnvelopeItem<AttachmentItemHeaders, unknown>;\nexport type UserFeedbackItem = BaseEnvelopeItem<UserFeedbackItemHeaders, UserFeedback>;\nexport type SessionItem =\n  | BaseEnvelopeItem<SessionItemHeaders, Session>\n  | BaseEnvelopeItem<SessionAggregatesItemHeaders, SessionAggregates>;\nexport type ClientReportItem = BaseEnvelopeItem<ClientReportItemHeaders, ClientReport>;\n\ntype EventEnvelopeHeaders = { event_id: string; sent_at: string };\ntype SessionEnvelopeHeaders = { sent_at: string };\ntype ClientReportEnvelopeHeaders = BaseEnvelopeHeaders;\n\nexport type EventEnvelope = BaseEnvelope<EventEnvelopeHeaders, EventItem | AttachmentItem | UserFeedbackItem>;\nexport type SessionEnvelope = BaseEnvelope<SessionEnvelopeHeaders, SessionItem>;\nexport type ClientReportEnvelope = BaseEnvelope<ClientReportEnvelopeHeaders, ClientReportItem>;\n\nexport type Envelope = EventEnvelope | SessionEnvelope | ClientReportEnvelope;\n"]}