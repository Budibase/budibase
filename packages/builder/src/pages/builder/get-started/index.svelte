<script lang="ts">
  import ExampleApp from "./_components/ExampleApp.svelte"
  import { Body, Button, Heading, Layout, Modal } from "@budibase/bbui"
  import { SplitPage } from "@budibase/frontend-core"
  import { goto } from "@roxi/routify"
  import { appsStore } from "@/stores/portal/apps"
  import BBLogo from "assets/BBLogo.svelte"
  import CreateWorkspaceModal from "../workspace/[application]/_components/CreateWorkspaceModal.svelte"

  let createWorkspaceModal: Modal
  let loading = false

  const initialise = async () => {
    // Need to refresh the workspaces to ensure the builder will load
    // The default workspace will then loaded.
    await appsStore.load()
    $goto("/builder")
  }
</script>

<Modal
  bind:this={createWorkspaceModal}
  on:show={() => (loading = true)}
  on:hide={() => (loading = false)}
>
  <CreateWorkspaceModal redirectOnCreate={false} on:created={initialise} />
</Modal>

<div class="full-width">
  <SplitPage>
    <div>
      <Layout justifyItems="center">
        <div class="budibaseLogo">
          <BBLogo size={36} color={"var(--spectrum-global-color-gray-900)"} />
        </div>
        <Heading>Create your own workspace</Heading>
        <Body textAlign="center">
          You don't currently have access to any workspaces, so let's get you
          set up with one of your own!
        </Body>
        <Button
          size="L"
          cta
          disabled={loading}
          on:click={() => {
            createWorkspaceModal.show()
          }}
        >
          Lets go!
        </Button>
      </Layout>
    </div>
    <div slot="right">
      <ExampleApp />
    </div>
  </SplitPage>
</div>

<style>
  .full-width {
    width: 100%;
  }
  .budibaseLogo {
    width: 42px;
  }
  .full-width :global(.split-page .left .content) {
    align-content: center;
  }
</style>
