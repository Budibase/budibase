<!doctype html>
<html class="spectrum spectrum--medium spectrum--darkest" lang="en" dir="ltr">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="width=device-width" />
    <title>Budibase</title>
    <link
      href="/builder/fonts/source-sans-3/source-sans-3.css"
      rel="stylesheet"
    />
    <link href="/builder/fonts/inter/inter.css" rel="stylesheet" />
    <link
      href="/builder/fonts/phosphor-icons/phosphor-icons.css"
      rel="stylesheet"
    />
    <link href="/builder/fonts/remixicon.css" rel="stylesheet" />
    <script>
      ;(() => {
        const ThemeClassPrefix = "spectrum--"
        const ThemeOptions = [
          { id: "light" },
          { id: "darkest" },
          { id: "nord", base: "darkest" },
          { id: "midnight", base: "darkest" },
        ]
        const fallback = "darkest"
        const themeBackgrounds = {
          light: "rgb(255, 255, 255)",
          darkest: "rgb(30, 30, 30)",
          nord: "#3b4252",
          midnight: "hsl(220, 10%, 17%)",
        }

        const ensureTheme = value => {
          if (!value) {
            return fallback
          }
          if (value.startsWith(ThemeClassPrefix)) {
            value = value.split(ThemeClassPrefix)[1]
          }
          if (value === "lightest") {
            return "light"
          }
          if (value === "dark") {
            return "darkest"
          }
          return ThemeOptions.some(option => option.id === value)
            ? value
            : fallback
        }

        const getThemeClassNames = value => {
          const theme = ensureTheme(value)
          const base = ThemeOptions.find(option => option.id === theme)?.base
          const classes = [`${ThemeClassPrefix}${theme}`]
          if (base) {
            classes.unshift(`${ThemeClassPrefix}${base}`)
          }
          return classes
        }

        const applyTheme = theme => {
          const normalized = ensureTheme(theme)
          const existing = document.documentElement.className
          const preserved = existing
            .split(/\s+/)
            .filter(
              name =>
                name &&
                name !== "spectrum" &&
                name !== "spectrum--medium" &&
                !name.startsWith(ThemeClassPrefix)
            )
          const classes = new Set(preserved)
          classes.add("spectrum")
          classes.add("spectrum--medium")
          getThemeClassNames(normalized).forEach(name => classes.add(name))
          document.documentElement.className = Array.from(classes).join(" ")
        }

        const setBackground = theme => {
          const normalized = ensureTheme(theme)
          const color =
            themeBackgrounds[normalized] || themeBackgrounds[fallback]
          document.documentElement.style.backgroundColor = color
          document.documentElement.style.colorScheme =
            normalized === "light" ? "light" : "dark"
          if (document.body) {
            document.body.style.backgroundColor = color
          } else {
            document.addEventListener(
              "DOMContentLoaded",
              () => {
                document.body.style.backgroundColor = color
              },
              { once: true }
            )
          }
        }

        const getStoredTheme = () => {
          try {
            const stored = localStorage.getItem("bb-theme")
            if (!stored) {
              return undefined
            }
            const parsed = JSON.parse(stored)
            if (parsed && typeof parsed.theme === "string") {
              return parsed.theme
            }
          } catch (error) {
            /* ignore */
          }
          return undefined
        }

        const theme = ensureTheme(getStoredTheme())
        applyTheme(theme)
        setBackground(theme)
      })()
    </script>
  </head>

  <body id="app">
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
